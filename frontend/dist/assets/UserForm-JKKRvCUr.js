import{_ as D,o as d,c as m,a,t as u,e as f,v as p,f as b,b as x,w as k,d as V,j as E,g as U,h,k as y,i as c,u as F,l as q}from"./index-CNicAdIR.js";import{a as v}from"./index-D5GkNzM3.js";const N={name:"UserForm",setup(){const w=F(),o=q(),l=c(!1),e=c(""),i=c({name:"",email:"",password:""}),n=y(()=>o.params.id),t=y(()=>!!n.value),s=async()=>{try{if(l.value=!0,e.value="",t.value){const r={...i.value};r.password||delete r.password,await v.put(`/api/users/${n.value}`,r),alert("更新用户成功")}else await v.post("/api/users",i.value),alert("创建用户成功");w.push("/")}catch(r){e.value=t.value?"更新用户失败":"创建用户失败",console.error(r)}finally{l.value=!1}},g=async()=>{if(t.value)try{const _=(await v.get(`/api/users/${n.value}`)).data.data;i.value={name:_.name,email:_.email,password:""}}catch(r){e.value="获取用户信息失败",console.error(r)}};return U(()=>{t.value&&g()}),{formData:i,loading:l,error:e,isEdit:t,submitForm:s}}},B={class:"user-form"},C={class:"form-group"},M={class:"form-group"},R={class:"form-group"},S=["required"],T={key:0},j={class:"form-actions"},I=["disabled"],z={key:0,class:"error"};function A(w,o,l,e,i,n){const t=h("router-link");return d(),m("div",B,[a("h1",null,u(e.isEdit?"编辑用户":"创建用户"),1),a("form",{onSubmit:o[3]||(o[3]=E((...s)=>e.submitForm&&e.submitForm(...s),["prevent"]))},[a("div",C,[o[4]||(o[4]=a("label",{for:"name"},"姓名",-1)),f(a("input",{type:"text",id:"name","onUpdate:modelValue":o[0]||(o[0]=s=>e.formData.name=s),required:"",placeholder:"请输入姓名"},null,512),[[p,e.formData.name]])]),a("div",M,[o[5]||(o[5]=a("label",{for:"email"},"邮箱",-1)),f(a("input",{type:"email",id:"email","onUpdate:modelValue":o[1]||(o[1]=s=>e.formData.email=s),required:"",placeholder:"请输入邮箱"},null,512),[[p,e.formData.email]])]),a("div",R,[o[6]||(o[6]=a("label",{for:"password"},"密码",-1)),f(a("input",{type:"password",id:"password","onUpdate:modelValue":o[2]||(o[2]=s=>e.formData.password=s),required:!e.isEdit,placeholder:"请输入密码"},null,8,S),[[p,e.formData.password]]),e.isEdit?(d(),m("small",T,"不填写则保持原密码")):b("",!0)]),a("div",j,[a("button",{type:"submit",class:"btn-primary",disabled:e.loading},u(e.loading?"提交中...":e.isEdit?"更新用户":"创建用户"),9,I),x(t,{to:"/",class:"btn-secondary"},{default:k(()=>[...o[7]||(o[7]=[V("返回列表",-1)])]),_:1})])],32),e.error?(d(),m("div",z,u(e.error),1)):b("",!0)])}const J=D(N,[["render",A]]);export{J as default};
